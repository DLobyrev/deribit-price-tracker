# Deribit Price Tracker

–°–µ—Ä–≤–∏—Å –¥–ª—è –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–≥–æ —Å–±–æ—Ä–∞ index price BTC/USD –∏ ETH/USD —Å –±–∏—Ä–∂–∏ Deribit –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ REST API.

## üì¶ –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Python 3.10+
- PostgreSQL
- Redis
- Docker (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –Ω–æ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

## ‚öôÔ∏è –£—Å—Ç–∞–Ω–æ–≤–∫–∞

1. –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:
   ```bash
   git clone https://github.com/DLobyrev/deribit-price-tracker.git
   cd deribit-price-tracker
   ```
2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
   ```bash
   pip install -r requirements.txt
    ```
3. –°–æ–∑–¥–∞–π—Ç–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –≤ PostgreSQL:
   ```sql
   CREATE DATABASE deribit_db;
   ```
4. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –≤ app/database.py (–∏–ª–∏ —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è DATABASE_URL):
   ```python
   DATABASE_URL = "postgresql://postgres:–≤–∞—à_–ø–∞—Ä–æ–ª—å@localhost:5432/deribit_db"
   ```

## ‚ñ∂Ô∏è –ó–∞–ø—É—Å–∫

1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ Redis (—á–µ—Ä–µ–∑ Docker):
   ```bash
   docker run -d --name redis-local -p 6379:6379 redis:7-alpine
   ```
2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ Celery Worker –∏ Beat:
   ```bash
    # –¢–µ—Ä–º–∏–Ω–∞–ª 1
    celery -A app.tasks:celery_app worker --loglevel=info --pool=solo
    
    # –¢–µ—Ä–º–∏–Ω–∞–ª 2
    celery -A app.tasks:celery_app beat --loglevel=info
   ```   
3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ FastAPI-—Å–µ—Ä–≤–µ—Ä:
   ```bash
   uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
   ``` 

```markdown
## üåê API –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã

–í—Å–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã —Ç—Ä–µ–±—É—é—Ç query-–ø–∞—Ä–∞–º–µ—Ç—Ä ticker (btc_usd –∏–ª–∏ eth_usd):

GET /prices/ ‚Äî –≤—Å–µ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ —Ü–µ–Ω—ã
GET /prices/latest/ ‚Äî –ø–æ—Å–ª–µ–¥–Ω—è—è —Ü–µ–Ω–∞
GET /prices/by-date/?date=YYYY-MM-DD ‚Äî —Ü–µ–Ω—ã –∑–∞ —É–∫–∞–∑–∞–Ω–Ω—É—é –¥–∞—Ç—É

–ü—Ä–∏–º–µ—Ä:
http://localhost:8000/prices/latest/?ticker=btc_usd
```

### üê≥ –ß–µ—Ä–µ–∑ Docker (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω [Docker](https://www.docker.com/products/docker-desktop).
2. –í –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:
   ```bash
   docker-compose up --build
   ```   
3. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ –ø–æ –∞–¥—Ä–µ—Å—É:
   API: http://localhost:8000
   Swagger UI: http://localhost:8000/docs
4. –î–∞–Ω–Ω—ã–µ –Ω–∞—á–Ω—É—Ç —Å–æ–±–∏—Ä–∞—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É.
5. –î–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –Ω–∞–∂–º–∏—Ç–µ Ctrl+C –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ.

üß† Design Decisions
Celery + Redis
1. –í—ã–±—Ä–∞–Ω–æ –∫–∞–∫ –ø—Ä–æ—Å—Ç–æ–µ –∏ –Ω–∞–¥—ë–∂–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –¥–ª—è –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏—Ö –∑–∞–¥–∞—á. Kafka –Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç, —Ç–∞–∫ –∫–∞–∫ —ç—Ç–æ stream-–ø–ª–∞—Ç—Ñ–æ—Ä–º–∞, –∞ –Ω–µ
–æ—á–µ—Ä–µ–¥—å –∑–∞–¥–∞—á. RabbitMQ –≤–æ–∑–º–æ–∂–µ–Ω, –Ω–æ –∏–∑–±—ã—Ç–æ—á–µ–Ω –¥–ª—è –Ω–∏–∑–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏.
2. –õ–æ–∫–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –≤–º–µ—Å—Ç–æ timestamp –æ—Ç –±–∏—Ä–∂–∏
Deribit –≤ —ç–Ω–¥–ø–æ–∏–Ω—Ç–µ get_index_price –Ω–µ –≤—Å–µ–≥–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç timestamp, –ø–æ—ç—Ç–æ–º—É —Ñ–∏–∫—Å–∏—Ä—É–µ–º –º–æ–º–µ–Ω—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ –∫–ª–∏–µ–Ω—Ç–∞.
3. SQLAlchemy ORM
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –¥–ª—è —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏ –∏ –±—ã—Å—Ç—Ä–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏. –î–ª—è junior-–ø—Ä–æ–µ–∫—Ç–∞ —ç—Ç–æ–≥–æ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ.
4. –ë–µ–∑ Pydantic-—Å—Ö–µ–º
–£–ø—Ä–æ—â–µ–Ω–æ –¥–æ dict –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏, –Ω–æ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–æ–¥–µ–ª–∏.
5. --pool=solo –¥–ª—è Celery –Ω–∞ Windows
–†–µ—à–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—ã —Å –º–Ω–æ–≥–æ–ø—Ä–æ—Ü–µ—Å—Å–Ω–æ—Å—Ç—å—é –≤ Windows-—Å—Ä–µ–¥–µ.